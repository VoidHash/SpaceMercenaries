
<!DOCTYPE html>
<html>
<head>
    <title>Space Mercenaries</title>
    <script src="lib/easeljs-0.7.1.min.js"></script>
    <script src="lib/tweenjs-0.5.1.min.js"></script>
    <script src="lib/soundjs-0.5.2.min.js"></script>
    <script src="lib/preloadjs-0.4.1.min.js"></script>
	
	<script src="lib/ndgmr.Collision.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Orbitron" rel="stylesheet">
</head>

<body onload="init()" style="margin: 5px">

<canvas id="canvas" width="800" height="600" style="border: black solid 1px"></canvas>

</body>

<script>

	const KEYCODE_LEFT = 37, 
		  KEYCODE_RIGHT = 39,
		  KEYCODE_UP = 38, 
		  KEYCODE_DOWN = 40,
		  SPACE_BAR = 32;
		  
	var leftKeyDown, rightKeyDown, upKeyDown, downKeyDown, spaceKeyDown = false;
		  
	var stage, queue, background, player, bullet, cd=0, time_stage = 0;
	var enemy01, enemy02, enemy03, enemy04, enemy05, enemy06, enemy07, enemy08;
	var spritesheet, explode, data_sprite, explode_fx;
	
	//Basic Bullet Stats
	var bullet01_stats = {offSetX:30, offSetY:30, damage:10, scaleX: 1.3, scaleY: 1.3, cd: 250}
	
	//Boss 01 Stats
	var boss_stats = {offSetX:30, offSetY:30, damage:10, scaleX: 0.5, scaleY: 0.5}
	
	//Enemies Stats
	var enemy_stats = {health: 30, damage: 10};
	
	//player status
	var player_stats = {health: 100, bullet:1}
	
	var score=0, score_text, health=100, health_txt, lives=3, lives_txt, high_score;
	
	var the_music, isAlive = true;
	
	var gameOver_text, stage_text, title_text;
	
	var btn_start, btn_continue;
	
	function init() {
	
		stage = new createjs.Stage(document.getElementById('canvas'));
		
		queue = new createjs.LoadQueue();
		queue.installPlugin(createjs.Sound);
		queue.addEventListener("complete", loadComplete);
		queue.loadManifest([
			{id:"background", src:"images/background.png"},
			{id:"background02", src:"images/background02.png"},
			{id:"background03", src:"images/background03.png"},
			{id:"player", src:"images/player.png"},
			{id:"bullet01", src:"images/bullet01.png"},
			{id:"bullet02", src:"images/bullet02.png"},
			{id:"enemy01", src:"images/spaceship01.png"},
			{id:"enemy02", src:"images/spaceship02.png"},
			{id:"enemy03", src:"images/spaceship03.png"},
			{id:"enemy04", src:"images/spaceship04.png"},
			{id:"enemy05", src:"images/spaceship05.png"},
			{id:"enemy06", src:"images/spaceship06.png"},
			{id:"enemy07", src:"images/spaceship07.png"},
			{id:"enemy08", src:"images/spaceship08.png"},
			{id:"boss", src:"images/boss.png"},
			{id:"bullet_sound01", src:"sounds/bullet01.mp3"},
			{id:"explosion_enemy", src:"sounds/explosion01.mp3"},
			{id:"explosion_sprite", src:"images/explosion_sprite.png"},
			{id:"stage01_music", src:"sounds/level1.mp3"},
			{id:"stage02_music", src:"sounds/level2.mp3"},
			{id:"stage03_music", src:"sounds/level3.mp3"},
			{id:"intro_music", src:"sounds/intro.mp3"},
			{id:"boss_music", src:"sounds/boss.mp3"},
			{id:"death_music", src:"sounds/death.mp3"},
		]);
		
		
		function loadComplete() {
			stage03();
			loadAssets();
			createjs.Ticker.addEventListener("tick", tick);
			createjs.Ticker.setFPS(60);
		}
		
		function loadAssets(){
			score_text = new createjs.Text();
			score_text.font = "bold 30px Orbitron";
			score_text.color= "#FFFFFF";
			score_text.text = "SCORE: 0";
			score_text.shadown = true;
			score_text.x = 20;
			score_text.y = 10;
			stage.addChild(score_text);
			
			health_txt = new createjs.Text();
			health_txt.font = "bold 30px Orbitron";
			health_txt.color= "#FFFFFF";
			health_txt.text = "ENERGY: 100";
			health_txt.shadown = true;
			health_txt.x = 550;
			health_txt.y = 10;
			stage.addChild(health_txt);
			
			lives_txt = new createjs.Text();
			lives_txt.font = "bold 30px Orbitron";
			lives_txt.color= "#FFFFFF";
			lives_txt.text = "Lives: 3";
			lives_txt.shadown = true;
			lives_txt.x = 625;
			lives_txt.y = 550;
			stage.addChild(lives_txt);
			
			gameOver_text = new createjs.Text();
			gameOver_text.font = "bold 40px Orbitron";
			gameOver_text.color= "#FFFFFF";
			gameOver_text.text = "GAME OVER";
			gameOver_text.regX = gameOver_text.getMeasuredWidth() / 2;
			gameOver_text.regY = gameOver_text.getMeasuredHeight () / 2;
			gameOver_text.shadown = true;
			gameOver_text.x = 400;
			gameOver_text.y = 300;
			//stage.addChild(gameOver_text);
			
			
			//Set Player 72x72
			var img = queue.getResult("player");
			player = new createjs.Bitmap(img);
			player.regX = player.getBounds().width/2;
			player.regy = player.getBounds().height/2;
			player.name = "player";
			player.scaleX = 0.1;
			player.scaleY = 0.1;
			player.x = 400;
			player.y = 500;
			player.st = player_stats;
			stage.addChild(player);
			window.onkeydown = movePlayer;
			window.onkeyup = stopPlayer;
			
			/*
			var img = queue.getResult("boss");
			boss = new createjs.Bitmap(img);
			boss.name = "boss";
			boss.x = 250;
			boss.y = 10;
			boss.scaleX = boss_stats.scaleX;
			boss.scaleY = boss_stats.scaleY;
			stage.addChild(boss);
			*/
			
			
			// 0, 160, 320, 480, 640
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.regX = enemy01.getBounds().width/2;
			enemy01.regy = enemy01.getBounds().height/2;
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			
			//stage.addChild(enemy01);
			
			var img = queue.getResult("enemy02");
			enemy02 = new createjs.Bitmap(img);
			enemy02.regX = enemy02.getBounds().width/2;
			enemy02.regy = enemy02.getBounds().height/2;
			enemy02.name = "enemy";
			enemy02.scaleX = 0.2;
			enemy02.scaleY = 0.2;
			enemy02.rotation = 180;
			//stage.addChild(enemy02);
			
			var img = queue.getResult("enemy03");
			enemy03 = new createjs.Bitmap(img);
			enemy03.regX = enemy03.getBounds().width/2;
			enemy03.regy = enemy03.getBounds().height/2;
			enemy03.name = "enemy";
			enemy03.scaleX = 0.2;
			enemy03.scaleY = 0.2;
			enemy03.rotation = 180;
			//stage.addChild(enemy03);
			
			var img = queue.getResult("enemy04");
			enemy04 = new createjs.Bitmap(img);
			enemy04.regX = enemy04.getBounds().width/2;
			enemy04.regy = enemy04.getBounds().height/2;
			enemy04.name = "enemy";
			enemy04.scaleX = 0.2;
			enemy04.scaleY = 0.2;
			enemy04.rotation = 180;
			//stage.addChild(enemy04);
			
			var img = queue.getResult("enemy05");
			enemy05 = new createjs.Bitmap(img);
			enemy05.regX = enemy05.getBounds().width/2;
			enemy05.regy = enemy05.getBounds().height/2;
			enemy05.name = "enemy";
			enemy05.scaleX = 0.2;
			enemy05.scaleY = 0.2;
			enemy05.rotation = 180;
			//stage.addChild(enemy05);
			
			var img = queue.getResult("enemy06");
			enemy06 = new createjs.Bitmap(img);
			enemy06.regX = enemy05.getBounds().width/2;
			enemy06.regy = enemy05.getBounds().height/2;
			enemy06.name = "enemy";
			enemy06.scaleX = 0.05;
			enemy06.scaleY = 0.05;
			enemy06.rotation = 180;
			//stage.addChild(enemy05);
			
			var img = queue.getResult("enemy07");
			enemy07 = new createjs.Bitmap(img);
			enemy07.regX = enemy05.getBounds().width/2;
			enemy07.regy = enemy05.getBounds().height/2;
			enemy07.name = "enemy";
			enemy07.scaleX = 0.06;
			enemy07.scaleY = 0.06;
			enemy07.rotation = 180;
			//stage.addChild(enemy05);
			
			var img = queue.getResult("enemy08");
			enemy08 = new createjs.Bitmap(img);
			enemy08.regX = enemy05.getBounds().width/2;
			enemy08.regy = enemy05.getBounds().height/2;
			enemy08.name = "enemy";
			enemy08.scaleX = 0.08;
			enemy08.scaleY = 0.08;
			enemy08.rotation = 180;
			//stage.addChild(enemy05);
			
			var img = queue.getResult("bullet01");
			bullet = new createjs.Bitmap(img);
			bullet.name = "bullet";
			bullet.scaleX = 1.3;
			bullet.scaleY = 1.3;
			bullet.st = {damage: 10};
			
			//Enemy Bullet
			var img = queue.getResult("bullet02");
			enemy_blt = new createjs.Bitmap(img);
			enemy_blt.name = "bullet";
			enemy_blt.st = {damage: 10};
			
			explode = {
				images: [queue.getResult("explosion_sprite")],
				frames: {width:128, height:128, count: 16},
				animations: {
					explode:[0,15],
					framerate: 20
				}
			};
			data_sprite = {
				images: [queue.getResult("explosion_sprite")],
				frames: {width:128, height:128, count: 16},
				animations: {
					explode:{
						frames:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],
						next: false,
						speed: 0.6
					}
				}
			};
			spriteSheet = new createjs.SpriteSheet(data_sprite);
			
			//
			explode_fx = new createjs.Sprite(spriteSheet, "explode");
			
			explode_fx_2 = new createjs.Sprite(spriteSheet, "explode");
		}
		
		function stage01(){
		
			//Play Stage 01 Music
			createjs.Sound.stop();
			createjs.Sound.play("stage01_music", {volume: 0.8,  loop: -1});

		
			// Set Background 
			var img = queue.getResult("background");
			background = new createjs.Bitmap(img);
			background.name = "background";
			background.y = -1200;
			background.addEventListener("tick", bgTick);
			function bgTick(event) {
				background.y= background.y + 0.5;
				if(background.y == 0){
					background.y = -1200;
				}
				
			}
			stage.addChild(background);
		}
		
		function stage02(){
		
			//Play Stage 01 Music
			createjs.Sound.stop();
			createjs.Sound.play("stage02_music", {volume: 0.8,  loop: -1});

		
			// Set Background 
			var img = queue.getResult("background02");
			background = new createjs.Bitmap(img);
			background.name = "background";
			background.y = -1200;
			background.addEventListener("tick", bgTick);
			function bgTick(event) {
				background.y= background.y + 0.5;
				if(background.y == 0){
					background.y = -1200;
				}
				
			}
			stage.addChild(background);
		}
		
		function stage03(){
		
			//Play Stage 01 Music
			createjs.Sound.stop();
			createjs.Sound.play("stage03_music", {volume: 0.8,  loop: -1});

		
			// Set Background 
			var img = queue.getResult("background03");
			background = new createjs.Bitmap(img);
			background.name = "background";
			background.y = -1200;
			background.addEventListener("tick", bgTick);
			function bgTick(event) {
				background.y= background.y + 0.5;
				if(background.y == 0){
					background.y = -1200;
				}
				
			}
			stage.addChild(background);
		}
		
		function movePlayer(e) {
			e = !e ? window.event : e;
			switch (e.keyCode) {
				case KEYCODE_LEFT:
					leftKeyDown = true;
					break;
				case KEYCODE_RIGHT:
					rightKeyDown = true;
					break;
				case KEYCODE_UP:	
					upKeyDown = true;
					break;
				case KEYCODE_DOWN:
					downKeyDown = true;
					break;
				case SPACE_BAR:
					spaceKeyDown = true;
					break;
			}
		}
		
		function stopPlayer(e) {
			e = !e ? window.event : e;
			switch (e.keyCode) {
				 case KEYCODE_LEFT:
					leftKeyDown = false;
					break;
				case KEYCODE_RIGHT:
					rightKeyDown = false;
					break;
				case KEYCODE_UP:
					upKeyDown = false;
					break;
				case KEYCODE_DOWN:
					downKeyDown = false;
					break;
				case SPACE_BAR:
					spaceKeyDown = false;
					break;
				
					
			}
		}
		
		function update() {
		
			//The Player gonna move here
			
			var nextX = player.x;
			var nextY = player.y;
			
			if (leftKeyDown) {
				nextX = player.x - 10;
				if(nextX < 35){
					nextX = 35;
				}
			}
			else if (rightKeyDown) {
				nextX = player.x + 10;
				if(nextX > stage.canvas.width - 35){
					nextX = stage.canvas.width - 35;
				}
			}
			
			if(upKeyDown){
				nextY = player.y - 10;
				if(nextY < 0){
					nextY = 0;
				}
			} else if (downKeyDown) {
				nextY = player.y + 10;
				if(nextY > stage.canvas.height - 72){
					nextY = stage.canvas.height - 72
				}
			}
			
			player.nextX = nextX;
			player.nextY = nextY;
			
			//Player gonna shoot here
			if(spaceKeyDown && isAlive) {
				//cooldown between 5 - 10
				cd++;
				if(cd == 10){
					fire();
					cd=0;
				}
			}
		}
		
		function render() {
			player.x = player.nextX;
			player.y = player.nextY;
		}
		
		function tick(e) {
			update();
			render();
			checkCollision();
			stage01();
			stage.update();
			time_stage++;
		}
		
		function checkCollision(){
			for(var i=0; i<stage.children.length; i++){
			
				if(stage.getChildAt(i).name == "enemy"){
					var intersection = ndgmr.checkRectCollision(stage.getChildAt(i), player);
					if(intersection != null){
						if(player.st.health > 0){
							health = health - stage.getChildAt(i).st.damage;
							player.st.health = health;
							health_txt.text = "HEALTH: " + health;
							kaboon(stage.getChildAt(i));
							
						}else{
							lives--;
							lives_txt.text = "LIVES: " + lives;
							stage.removeChild(player);
							if(lives > 0){
								player.x = 400;
								player.y = 500;
								health = 100;
								player.st.health = health;
								stage.addChild(player);
							}else{
								isAlive = false;
								player.y = 801;
								stage.addChild(gameOver_text);
								createjs.Sound.stop();
								createjs.Sound.play("death_music",{volume: 0.8, loop: -1});
							}
							
							
						}
						//stage.removeChild(player);
						stage.removeChildAt(i);
						intersection = null;
					}
				}
				
				if(stage.getChildAt(i).y <= -200 || stage.getChildAt(i).y >= 800 || 
				stage.getChildAt(i).x <= -200 || stage.getChildAt(i).x >= 1000){
					if(stage.getChildAt(i).name != "background"){
						stage.removeChildAt(i);
					}
				}
				
				
			}
		}
		
		function fire(){
			
			var the_bullet = bullet.clone();
			the_bullet.x = player.x-5;
			the_bullet.y = player.y;
			the_bullet.st = bullet01_stats;
			stage.addChild(the_bullet);
			time  = (the_bullet.y + 200 ) / 0.99;
			createjs.Tween.get(the_bullet).to({y:-200}, time);
			
			the_bullet.addEventListener("tick", collisionEvent);
			createjs.Sound.play("bullet_sound01",{volume: 0.1});
			
			function collisionEvent(event) {
			
				for(var i=0; i<stage.children.length; i++){
					if(stage.getChildAt(i).name == "enemy"){
						var intersection = ndgmr.checkRectCollision(stage.getChildAt(i), the_bullet);
						if(intersection != null){							
							stage.getChildAt(i).st.health -= the_bullet.st.damage;
							if(stage.getChildAt(i).st.health <= 0){
								
								score = score + 10;
								score_text.text = "SCORE: "+score;
								kaboon(stage.getChildAt(i));
								stage.removeChildAt(i);
							}
							stage.removeChild(the_bullet);
							intersection = null;
						}
					}		
				}
			}
		}
		
		function kaboon(gameObject){
			createjs.Sound.play("explosion_enemy",{volume: 0.3});
			var explode = explode_fx.clone();
			explode.x=gameObject.x-60;
			explode.y=gameObject.y-60;
			explode.addEventListener("animationend", endAnimation);
			function endAnimation(event) {
				stage.removeChild(explode);
			 }
			stage.addChild(explode);
		}
		
		function stage01(){
			
			if(time_stage  == 60*3){
				wave02(enemy02, 100, -100, 1);
				wave03(enemy03, 100, -100, 1);	
				wave02(enemy02, 100, -100, 2);
				wave03(enemy03, 100, -100, 2);
				wave02(enemy02, 100, -100, 3);
				wave03(enemy03, 100, -100, 3);
				wave02(enemy02, 100, -100, 4);
				wave03(enemy03, 100, -100, 4);
				wave02(enemy02, 100, -100, 4);
				wave03(enemy03, 100, -100, 4);
			}
			
			if(time_stage == 60*6){
				wave01(enemy01, 100, -100, 1);
				wave01(enemy01, 200, -100, 2);
				wave01(enemy01, 300, -100, 3);
				wave01(enemy01, 400, -100, 4);
				wave01(enemy01, 500, -100, 5);
				wave01(enemy01, 600, -100, 6);
				wave01(enemy01, 700, -100, 7);
			}
			
			if(time_stage == 60*8){
				wave01(enemy04, 700, -100, 1);
				wave01(enemy04, 600, -100, 2);
				wave01(enemy04, 500, -100, 3);
				wave01(enemy04, 400, -100, 4);
				wave01(enemy04, 500, -100, 5);
				wave01(enemy04, 300, -100, 6);
				wave01(enemy04, 200, -100, 7);
				wave01(enemy04, 100, -100, 8);
			}
			
			
			if(time_stage == 60*10){
				wave04(enemy05, 400, -100, 1);
				wave05(enemy06, 400, -100, 1.5);
				wave04(enemy05, 400, -100, 2);
				wave05(enemy06, 400, -100, 2.5);
				wave04(enemy05, 400, -100, 1);
				wave05(enemy06, 400, -100, 1.5);
				wave04(enemy05, 400, -100, 2);
				wave05(enemy06, 400, -100, 2.5);
				
			}
			
			if(time_stage == 60*13){
				wave06(enemy07, 400, -100, 1);
				wave07(enemy08, 400, -100, 1.5);
				wave06(enemy07, 400, -100, 2);
				wave07(enemy08, 400, -100, 2.5);
				wave06(enemy07, 400, -100, 1);
				wave07(enemy08, 400, -100, 1.5);
				wave06(enemy07, 400, -100, 2);
				wave07(enemy08, 400, -100, 2.5);
				
				time_stage=0;
			}
			
			/*
			if(time_stage  % 120 == 0){
				wave01(enemy08, 100, -100, 1);
			}
			*/
		}
		
		function enemy_attack(event){
		
			if(time_stage % 60 == 0 && isAlive){
				var rand = Math.floor((Math.random() * 100) + 1);
				if(rand <= 40){
					var blt = enemy_blt.clone();
					blt.x = event.currentTarget.x;
					blt.y = event.currentTarget.y;
					blt.name = "enemy";				
					blt.st = enemy_stats;					
					stage.addChild(blt);
					createjs.Tween.get(blt).to({x:player.x, y:player.y}, 1500).call(blt_tween);
					function blt_tween() {
						kaboon(blt);
						stage.removeChild(blt);
					}
				}				
			}
		}
		
		// Go Forward
		function wave01(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			enemy.addEventListener("tick", enemy_attack);

			stage.addChild(enemy);
			time  = (Math.abs(posY)+600 ) / 0.4; //time = 2000ms
			createjs.Tween.get(enemy).wait(250*next).to({y:800}, time);
		}
		
		//go Z
		function wave02(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			enemy.addEventListener("tick", enemy_attack);
			
			stage.addChild(enemy);
			//time  = (Math.abs(posY)+600 ) / 0.4; //time = 2000ms
			createjs.Tween.get(enemy).wait(250*next)
			.to({y:100}, 500)
			.to({y:250, x:750}, 1000)
			.to({y:400, x:50}, 1000)
			.to({y:550, x:750}, 1000)
			.to({y:800}, 500);
		}
		
		//go Z mirror
		function wave03(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			
			enemy.addEventListener("tick", enemy_attack);
			stage.addChild(enemy);
			//time  = (Math.abs(posY)+600 ) / 0.4; //time = 2000ms
			createjs.Tween.get(enemy).wait(250*next)
			.to({y:100, x: 750}, 500)
			.to({y:250, x:50}, 1000)
			.to({y:400, x:750}, 1000)
			.to({y:550, x:50}, 1000)
			.to({y:800}, 500);
		}
		
		//go O mirror
		function wave04(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			
			enemy.addEventListener("tick", enemy_attack);
			stage.addChild(enemy);
			createjs.Tween.get(enemy).wait(250*next)
			.to({y:100, x: 400}, 500)
			.to({y:350, x:50}, 500)
			.to({y:550, x:400}, 500)
			.to({y:350, x:750}, 500)
			.to({y:100, x:400}, 500)
			.to({y:800}, 500);
		}
		
		//go O
		function wave05(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			
			enemy.addEventListener("tick", enemy_attack);
			stage.addChild(enemy);
			createjs.Tween.get(enemy).wait(250*next)
			.to({y:100, x: 400}, 500)
			.to({y:350, x:750}, 500)
			.to({y:550, x:400}, 500)
			.to({y:350, x:50}, 500)
			.to({y:100, x:400}, 500)
			.to({y:801}, 500);
		}
		
		//go M
		function wave06(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			
			enemy.addEventListener("tick", enemy_attack);
			stage.addChild(enemy);
			createjs.Tween.get(enemy).wait(250*next)
			.to({x:400, y: 100},500)
			.to({x:400, y: 550},500)
			.to({x:700, y: 100},500)
			.to({x:700, y: 550},500)
			.to({x:100, y: 100},500)
			.to({x:100, y: 801},500)
			
		}
		
		//go M mirror
		function wave07(enemyX, posX, posY, next){
			enemy = enemyX.clone();
			enemy.x = posX;
			enemy.y = posY;
			enemy.st = enemy_stats;
			
			enemy.addEventListener("tick", enemy_attack);
			stage.addChild(enemy);
			createjs.Tween.get(enemy).wait(250*next)
			.to({x:400, y: 100},500)
			.to({x:400, y: 550},500)
			.to({x:100, y:100}, 500)
			.to({x:100, y:550}, 500)
			.to({x:700, y:100}, 500)
			.to({y:801}, 500);
		}
    }

</script>

</html>
<!DOCTYPE html>
<html>
<head>
    <title>Space Mercenaries</title>
    <script src="lib/easeljs-0.7.1.min.js"></script>
    <script src="lib/tweenjs-0.5.1.min.js"></script>
    <script src="lib/soundjs-0.5.2.min.js"></script>
    <script src="lib/preloadjs-0.4.1.min.js"></script>
	
	<script src="lib/ndgmr.Collision.js"></script>
</head>

<body onload="init()" style="margin: 5px">

<canvas id="canvas" width="800" height="600" style="border: black solid 1px"></canvas>

</body>

<script>

	const KEYCODE_LEFT = 37, 
		  KEYCODE_RIGHT = 39,
		  KEYCODE_UP = 38, 
		  KEYCODE_DOWN = 40;
		  
	var leftKeyDown, rightKeyDown, upKeyDown, downKeyDown = false;
		  
	var stage, queue, background, player, bullet;
	var enemy01;
	
	var b01_stats = {offSetX:30, offSetY:30, damage:10, scaleX: 1.3, scaleY: 1.3}
	
	//player status
	
	function init() {
	
		stage = new createjs.Stage(document.getElementById('canvas'));
		
		queue = new createjs.LoadQueue();
		queue.addEventListener("complete", loadComplete);
		queue.loadManifest([
			{id:"background", src:"images/background.png"},
			{id:"player", src:"images/player.png"},
			{id:"bullet01", src:"images/bullet01.png"},
			{id:"enemy01", src:"images/spaceship01.png"},
			{id:"enemy02", src:"images/spaceship02.png"},
			{id:"enemy03", src:"images/spaceship03.png"}
		]);	
		
		function loadComplete() {
			stage01();
			
			createjs.Ticker.addEventListener("tick", tick);
			createjs.Ticker.setFPS(60);
		}
		
		function stage01(){
			// Set Background 
			var img = queue.getResult("background");
			background = new createjs.Bitmap(img);
			background.scaleX = 1
			background.scaleY = 1;
			background.x = 0;
			stage.addChild(background);
			
			//Set Player 72x72
			var img = queue.getResult("player");
			player = new createjs.Bitmap(img);
			player.name = "player";
			player.scaleX = 0.1;
			player.scaleY = 0.1;
			player.x = 350;
			player.y = 500;
			stage.addChild(player);
			window.onkeydown = movePlayer;
			window.onkeyup = stopPlayer;
			
			// 0, 160, 320, 480, 640
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			enemy01.x = 0;
			enemy01.y = 250;
			stage.addChild(enemy01);
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			enemy01.x = 160;
			enemy01.y = 250;
			stage.addChild(enemy01);
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			enemy01.x = 320;
			enemy01.y = 150;
			stage.addChild(enemy01);
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			enemy01.x = 480;
			enemy01.y = 250;
			stage.addChild(enemy01);
			
			var img = queue.getResult("enemy01");
			enemy01 = new createjs.Bitmap(img);
			enemy01.name = "enemy";
			enemy01.scaleX = 0.1;
			enemy01.scaleY = 0.1;
			enemy01.rotation = 180;
			enemy01.x = 640;
			enemy01.y = 150;
			stage.addChild(enemy01);
			
		}
		
		function movePlayer(e) {
			e = !e ? window.event : e;
			switch (e.keyCode) {
				case KEYCODE_LEFT:
					leftKeyDown = true;
					break;
				case KEYCODE_RIGHT:
					rightKeyDown = true;
					break;
				case KEYCODE_UP:
					fire();				
					upKeyDown = true;
					break;
				case KEYCODE_DOWN:
					downKeyDown = true;
					break;
			}
		}
		
		function stopPlayer(e) {
			e = !e ? window.event : e;
			switch (e.keyCode) {
				 case KEYCODE_LEFT:
					leftKeyDown = false;
					break;
				case KEYCODE_RIGHT:
					rightKeyDown = false;
					break;
				case KEYCODE_UP:
					upKeyDown = false;
					break;
				case KEYCODE_DOWN:
					downKeyDown = false;
					break;
			}
		}
		
		function update() {
			//console.log(player.x);
			var nextX = player.x;
			var nextY = player.y;
			
			if (leftKeyDown) {
				nextX = player.x - 10;
				if(nextX < 0){
					nextX = 0;
				}
			}
			else if (rightKeyDown) {
				nextX = player.x + 10;
				if(nextX > stage.canvas.width - 72){
					nextX = stage.canvas.width - 72;
				}
			}
			
			if(upKeyDown){
				nextY = player.y - 10;
				if(nextY < 0){
					nextY = 0;
				}
			} else if (downKeyDown) {
				nextY = player.y + 10;
				if(nextY > stage.canvas.height - 72){
					nextY = stage.canvas.height - 72
				}
			}
			
			player.nextX = nextX;
			player.nextY = nextY;
		}
		
		function render() {
			player.x = player.nextX;
			player.y = player.nextY;
		}
		
		function tick(e) {
			update();
			render();
			checkCollision();
			stage.update();
		}
		
		function checkCollision(){
			for(var i=0; i<stage.children.length; i++){
				
				if(stage.getChildAt(i).name == "enemy" || stage.getChildAt(i).name == "bullet"){
					var intersection = ndgmr.checkRectCollision(stage.getChildAt(i), player);
					if(intersection != null){
						//stage.removeChild(player);
						stage.removeChildAt(i);
						intersection = null;
					}
				}
				
			}
		}
		
		function fire(){
			//Basic Bullet
			var img = queue.getResult("bullet01");
			bullet = new createjs.Bitmap(img);
			bullet.name = "bullet";
			bullet.scaleX = b01_stats.scaleX;
			bullet.scaleY = b01_stats.scaleY;
			bullet.x = player.x + b01_stats.offSetX;
			bullet.y = player.y - b01_stats.offSetY;
			stage.addChild(bullet);
			time  = Math.abs((bullet.y - (-500) ) / 1);
			console.log("Time: "+time);
			console.log("bulletY: "+bullet.y);
			createjs.Tween.get(bullet).to({y:-250}, time);
		}
    }

</script>

</html>